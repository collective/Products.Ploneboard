  <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
    lang="en-US"
    metal:use-macro="here/main_template/macros/master"
    i18n:domain="gruf">

    <metal:block fill-slot="head_slot"
      tal:define="dummy python:request.set('disable_border', 1)"
      />
      <body>
        <div metal:fill-slot="main" id="content-news"
          tal:define="spaces python:container.portal_catalog(portal_type='GroupSpace',listUserIdsInGroup=here.portal_membership.getAuthenticatedMember().getUserName());
          Batch python:modules['Products.CMFPlone'].Batch;
          b_start python:request.get('b_start',0);
          usericon_imgtag here/user.gif;
          portal_discussion nocall:here/portal_discussion;
          desc_length python:here.portal_properties.site_properties.search_results_description_length;
          desc_ellipsis python:here.portal_properties.site_properties.ellipsis;
          ">
          <h1 i18n:translate="">My Group Spaces</h1>
          <p i18n:translate="">
            Here is a list of the group spaces you are member of, and the latest modifications inside each of them.
          </p>
          <tal:block tal:repeat="groupspace spaces">
            <tal:block tal:define="
              gsObject groupspace/getObject; 
              home_url python: here.portal_membership.getHomeUrl;
              localized_time python: modules['Products.CMFPlone.PloneUtilities'].localized_time;
              owners python:gsObject.listGroupOwners();
              results python:here.portal_catalog.searchResults( 
              getGroupSpaceId=gsObject.getGroupSpaceId(),
              portal_type=here.listGroupSpaceContentTypes(),
              sort_on='Date',
              sort_order='reverse',
              )[:5];
              ">
              <div class="portlet">
                <h6>
                  <img src="" alt="Type" style="border: 0"
                       tal:attributes="src groupspace/getIcon;
                    alt groupspace/Type" />
                    <span tal:omit-tag="" i18n:translate="">Managed by</span>
                    <span tal:omit-tag="" tal:repeat="owner python:owners[:3]">
                      <a href=""
                         tal:attributes="href python: home_url(owner)"
                        >
                        <span tal:replace="owner">Owner</span>
                      </a>
                      <span tal:condition="not: repeat/owner/end">,</span>
                    </span>
                    <span tal:condition="python:len(owners) > 3">, ...</span>
                    - <span tal:replace="python:len(gsObject.listGroupSpaceMemberUsers())">123</span> <span tal:omit-tag="" i18n:translate="">members inside</span>
                </h6>
                <div class="portletBody">
                  <div class="portletContent"
                       tal:define="resulturl gsObject/absolute_url">
                    <h2>
                      <a 
                         href=""
                         tal:content="python:test(groupspace.Title, groupspace.Title, groupspace.getId)"
                         tal:attributes="href groupspace/getURL"
                        >
                        Title
                      </a>
                    </h2>
                    
                    <p tal:content="structure groupspace/Description">
                      Description
                    </p>


                    <div tal:condition="results">
                      <div tal:replace="nothing">
                        MAY BE USEFUL... ONE DAY :)
                        <a href="" tal:attributes="href string:${here/absolute_url}/search_rss?${request/QUERY_STRING}">
                          <img i18n:attributes="title alt"
                            tal:attributes="src string:$portal_url/rss.gif"
                            src="rss.gif"
                            alt="RSS Feed"
                            title="RSS feed of these search results" />
                        </a>
                      </div>

                      <dl>
                        <tal:results repeat="result results">
                          <tal:entry define="result_url result/getURL;
                            url string:$result_url/view">
                            <dt>
                              <a href="#"
                                 tal:attributes="href url">
                                <img src="#"
                                     height="16"
                                     width="16"
                                     alt=""
                                     tal:on-error="structure python:path('here/linkOpaque.gif')"
                                  tal:replace="structure python:path('here/%s' % result.getIcon)" /></a>
                              &nbsp;
                              <a
                                 href="#" tal:attributes="href url"
                                tal:content="python:result.Title or result.getId" />
                                <span class="discreet" i18n:translate="results_by_author">
                                  by <span tal:replace="result/Creator" i18n:name="author">Author</span>,
                                  <span tal:replace="python:here.toPortalTime(result.ModificationDate, long_format=1)" i18n:name="date">Modification Date</span>
                                </span>
                            </dt>
                            <dd tal:content="python:here.cropText(result.Description, desc_length, desc_ellipsis)"> Description </dd>
                          </tal:entry>
                        </tal:results>
                      </dl>
                    </div>

                    <div i18n:translate="" tal:condition="not:results">
                      There is nothing is this group space yet.
                    </div>
                  </div>
                </div>
              </div>
            </tal:block>
          </tal:block>
          <p tal:condition="not: spaces" i18n:translate="">
            You are not a member of any group space.
          </p>
        </div>
      </body>
  </html>
