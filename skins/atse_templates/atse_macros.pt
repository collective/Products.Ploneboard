<metal:div metal:define-macro="selection">
  <div class="portlet">
    <h5 i18n:translate="selection">Registered Objects</h5>
    <div class="portletBody">
     <div style="margin: 5px 1px 5px 1px;">
      <form method="POST" action="atse_selectRegisteredSchema">
      <input type="hidden" name="schema_template" value="#"
             tal:attributes="value SCHEMA_TEMPLATE">
      <select name="selection:string">
        <span tal:repeat="item here/atse_getRegisteredSchemata">
          <option tal:attributes="value item;
                                  selected python: item == SCHEMA_ID"
                  tal:content="item" />
        </span>
      </select>
      <input type="submit" value="select" name="submit">
      </form>
    </div>
   </div>
  </div>
</metal:div>

<metal:div metal:define-macro="type">
    <span class="label" i18n:translate="type">Type</span>
    <div>
      <select name="fielddata.type:record:string">
        <span tal:repeat="item python: ('StringField', 'IntegerField', 'FloatField', 'FixedPointField', 'LinesField', 'DateTimeField', 'BooleanField', 'ReferenceField')">
          <option tal:attributes="value item;
                                  selected python: item==here.atse_getFieldType(field)"
                  tal:content="item" />
        </span>
      </select>
    </div>

</metal:div>
            

<metal:div metal:define-macro="widget">

    <span class="label" i18n:translate="widget">Widget</span>
    <div>

      <select name="fielddata.widget:record:string">
        <option value="String" 
                tal:content="string:String"
                tal:attributes="selected python: widget_name=='StringWidget'" />
        <option value="Textarea" 
                tal:content="string:Textarea"
                tal:attributes="selected python: widget_name=='TextAreaWidget'" />
        <option value="Radio" 
                tal:content="string:Radio"
                tal:attributes="selected python: widget_name=='SelectionWidget' and field.widget.format=='radio'"/>
        <option value="Select" 
                tal:content="string:Select"
                tal:attributes="selected python: widget_name=='SelectionWidget' and field.widget.format=='select'"/>
        <option value="Flex" 
                tal:content="string:flexible Selection"
                tal:attributes="selected python: widget_name=='SelectionWidget' and field.widget.format=='flex'"/>
        <option value="Lines" 
                tal:content="string:Lines"
                tal:attributes="selected python: widget_name=='LinesWidget' "/>
        <option value="Calendar" 
                tal:content="string:Calendar"
                tal:attributes="selected python: widget_name=='CalendarWidget' "/>
        <option value="Boolean" 
                tal:content="string:Boolean"
                tal:attributes="selected python: widget_name=='BooleanWidget' "/>
        <option value="MultiSelect" 
                tal:content="string:MultiSelect"
                tal:attributes="selected python: widget_name=='MultiSelectionWidget' "/>


        <option value="Richtext" 
                tal:content="string:Richtext"
                tal:attributes="selected python: widget_name=='RichWidget' "/>
        <option value="Password" 
                tal:content="string:Password"
                tal:attributes="selected python: widget_name=='PasswordWidget' "/>
        <option value="Visual" 
                tal:content="string:Visual"
                tal:attributes="selected python: widget_name=='VisualWidget' "/>
        <option value="Epoz" 
                tal:content="string:Epoz"
                tal:attributes="selected python: widget_name=='EpozWidget' "/>
        <option value="Picklist"
                tal:content="string:Picklist MultiSelect"
                tal:attributes="selected python: widget_name=='PicklistWidget' "/>
        <option value="InAndOut"
                tal:content="string:InAndOut MultiSelect"
                tal:attributes="selected python: widget_name=='InAndOutWidget' "/>
        <option value="ReferenceBrowserWidget"
                tal:content="string:ReferenceBrowserWidget"
                tal:attributes="selected python: widget_name=='ReferenceBrowserWidget'"
        		tal:condition="exists:here/referencebrowser_popup"/>

        <tal:comment tal:replace="nothing">
            <option value="Image" 
                    tal:content="string:Image"
                    tal:attributes="selected python: widget_name=='ImageWidget' "/>
            <option value="Integer" 
                    tal:content="string:Integer"
                    tal:attributes="selected python: widget_name=='IntegerWidget' "/>
            <option value="Decimal" 
                    tal:content="string:Decimal"
                    tal:attributes="selected python: widget_name=='DecimalWidget' "/>
            <option value="Reference" 
                    tal:content="string:Reference"
                    tal:attributes="selected python: widget_name=='ReferenceWidget' "/>
            <option value="Keywords" 
                    tal:content="string:Keywords"
                    tal:attributes="selected python: widget_name=='KeywordWidget' "/>
        </tal:comment>

      </select>
    </div>
</metal:div>

<metal:div metal:define-macro="size">

    <span class="label" i18n:translate="size">Size</span>
    <div>
          
      <metal:block tal:condition="python: widget_name in ('TextAreaWidget', 'LinesWidget')">
        <metal:block tal:condition="python: hasattr(widget, 'rows')">       
          <span i18n:translate="rows">Rows</span>
          <input type="text" size="3" name="fielddata.widgetrows:record:int" 
                 tal:attributes="value widget/rows|string:10"/>
        </metal:block>
        <metal:block tal:condition="python: hasattr(widget, 'cols')">       
          <br>
          <span i18n:translate="cols">Cols</span>
          <input type="text" size="3" name="fielddata.widgetcols:record:int" 
                 tal:attributes="value widget/cols|string:60"/>
        </metal:block>
      </metal:block>

      <metal:block tal:condition="not: python: widget_name in ('TextAreaWidget', 'LinesWidget')">
         <span i18n:translate="size">Size</span>
         <input type="text" size="3" name="fielddata.widgetsize:record:int" 
                tal:attributes="value widget/size|string:60"/>
      </metal:block>
    </div>
</metal:div>

<metal:div metal:define-macro="maintenance">

  <div class="portlet">
    <h5 i18n:translate="maintenance">Maintenance</h5>
    <div class="portletBody" id="atse_maintenance">
      <div tal:condition="python: here.atse_editorCanUpdate(SCHEMA_ID)">
        <a href="#" 
	   tal:attributes="href string: ${here/absolute_url}/atse_updateManagedSchema?portal_type=$SCHEMA_ID&schema_template=$SCHEMA_TEMPLATE"
	   i18n:translate="update_schema_for_all_schemas">Update schema for all managed schemas</a>
      </div>
      <div tal:condition="python: not here.atse_editorCanUpdate(SCHEMA_ID)">
       <b>This schema is actually not configured to update its associated objects</b>
      </div>
      <div>
        <a href="#" 
           tal:attributes="href string: ${here/absolute_url}/atse_dump_schema?schema_id=$SCHEMA_ID"
           i18n:translate="update_schema_for_all_schemas">Dump schema</a>
      </div>
    </div>
  </div>

</metal:div>


<metal:div metal:define-macro="fieldsets">
  <div class="portlet" tal:condition="fieldsets">    <!-- Fieldsets -->
    <h5 i18n:translate="schematas">Schematas</h5>
    <div class="portletBody" id="atse_fieldsets">
      <div tal:repeat="set fieldsets">
        <div class="left">
           <a tal:content="string: ${set}" 
              tal:attributes="href string:${here/absolute_url}/$SCHEMA_TEMPLATE?schema_template=$SCHEMA_TEMPLATE&schema_id=$SCHEMA_ID&schemata=${set};
                             id python: test(set==fieldset, 'atse_selected', '')"/>
        </div>
        <div class="right">
            <a tal:attributes="href string:atse_schemataMoveLeft?schema_template=$SCHEMA_TEMPLATE&schema_id=$SCHEMA_ID&name=${set}"><img src="arrowUp.gif" title="Move up"></a> 
            <a tal:attributes="href string:atse_schemataMoveRight?schema_template=$SCHEMA_TEMPLATE&schema_id=$SCHEMA_ID&name=${set}"><img src="arrowDown.gif" title="Move down"></a> 
            <a tal:attributes="href string:atse_delSchemata?schema_template=$SCHEMA_TEMPLATE&schema_id=$SCHEMA_ID&name=${set}"><img src="delete.gif" title="Delete"></a> 
        </div>
        <div class="clear"> </div>
      </div>

      <div>
        <form action="atse_addSchemata" method="post">
         <input type="hidden" name="schema_id" tal:attributes="value SCHEMA_ID" />
         <input type="hidden" name="schema_template" tal:attributes="value SCHEMA_TEMPLATE" />
         <input type="text" name="name" value="" >
         <input type="image" src="add_icon.gif">
        </form>
      </div>
    </div>
  </div>
</metal:div>


<metal:div metal:define-macro="fields">
  <div class="portlet" tal:condition="fieldsets">    <!-- Fields -->
    <h5 i18n:translate="fields">Fields</h5>
    <div class="portletBody" id="atse_fields">  
      <div  tal:repeat="field python: here.atse_getSchemata(SCHEMA_ID, fieldset).fields()">
        <div class="left">
          <a tal:attributes="href string:${here/absolute_url}/$SCHEMA_TEMPLATE?schema_template=$SCHEMA_TEMPLATE&schema_id=$SCHEMA_ID&schemata=${fieldset}&field=${field/getName};
                             id python: test(field.getName() == request.get('field'), 'atse_selected', '')"
              tal:content="string: ${field/getName}" />
        </div>
        <div class="right">
          <a tal:attributes="href string:atse_fieldMoveLeft?schema_template=$SCHEMA_TEMPLATE&schema_id=$SCHEMA_ID&name=${field/getName}"><img src="arrowUp.gif" title="Move up"></a> 
          <a tal:attributes="href string:atse_fieldMoveRight?schema_template=$SCHEMA_TEMPLATE&schema_id=$SCHEMA_ID&name=${field/getName}"><img src="arrowDown.gif" title="Move down"></a> 
          <a tal:attributes="href string:atse_delField?schema_template=$SCHEMA_TEMPLATE&schema_id=$SCHEMA_ID&name=${field/getName}"><img src="delete.gif" title="Delete"></a> 
        </div>
        <div class="clear"> </div>
      </div>

      <div>
        <form action="atse_update" method="post">
          <input type="hidden" name="schema_id" tal:attributes="value SCHEMA_ID" />
          <input type="hidden" name="schema_template" tal:attributes="value SCHEMA_TEMPLATE" />
          <input type="hidden" name="fielddata.schemata:record:string"    
               tal:attributes="value fieldset" />
            <input type="hidden" name="add_field" value="dummy"> 
            <input type="text" name="name" value=""> 
            <input type="image" src="add_icon.gif" value="Add">
        </form>
      </div>
    </div>
  </div>
</metal:div>



<metal:div metal:define-macro="fieldeditor">

  <div class="portlet" id="atse_field_editor" tal:condition="request/field|nothing"> 
    <h5 i18n:translate="field_definition">Field definition for <b tal:content="request/field"/></h5>
    <div class="portletBody" id="atse_fieldeditor">

      <form action="atse_update" method="post"
            tal:define="field python: here.atse_getField(SCHEMA_ID, request['field']);
                        widget python: field.widget;
                        widget_name python:field.getWidgetName()">
        <input type="hidden" name="schema_id" tal:attributes="value SCHEMA_ID" >
        <input type="hidden" name="schema_template" tal:attributes="value SCHEMA_TEMPLATE" />

        <input type="hidden" name="fielddata.name:record:string" 
               tal:attributes="value request/field|nothing" />
        <input type="hidden" name="fielddata.schemata:record:string"    
             tal:attributes="value fieldset" />
                                                                        
        <div>
          <div class="left">
             <tal:div metal:use-macro="here/atse_macros/macros/type" />         
           </div>
           <div class="left">
             <tal:div metal:use-macro="here/atse_macros/macros/widget" />         
           </div>
           <div class="left">
             <tal:div metal:use-macro="here/atse_macros/macros/size" />         
          </div>
          <div class="clear">&nbsp; </div>
     
        </div>
        <div class="clear"> </div>

        <div tal:condition="python: widget_name in ('MultiSelectionWidget', 'SelectionWidget', 'PicklistWidget', 'InAndOutWidget')">
          <span class="label" i18n:translate="vocabulary">
            Vocabulary (Use "key|value" for passing key-value pairs 
            or 'method:&lt;methodname&gt;')
          </span>
          <div> 
            <textarea cols="60" rows="6"
                   name="fielddata.vocabulary:record:lines"
                   tal:condition="python: widget_name in ('MultiSelectionWidget', 'SelectionWidget', 'PicklistWidget', 'InAndOutWidget')"
                   tal:content="python: here.atse_formatVocabulary(field)"></textarea>
          </div>
        </div>

        <div>
          <span class="label" i18n:translate="default">Default</span>
          <div>
            <input type="text" value="" size="40" 
                   name="fielddata.default:record:string"
                   tal:attributes="value python: here.atse_field_default(field)"/>
          </div>
        </div>

    	<br/>

        <div>
          <span class="label" i18n:translate="Validators">Validators</span>
          <div>
            <input type="text" value="" size="40" 
                   name="fielddata.validators:record:string"
                   tal:attributes="value python: ', '.join(getattr(field.widget, 'validators', ()))"/>
          </div>
        </div>

    	<br/>

        <div>
          <span class="label" i18n:translate="label">Label</span>
          <div>
            <input type="text" value="" size="40" 
                   name="fielddata.label:record:string"
                   tal:attributes="value python: field.widget.label"/>
          </div>
        </div>
      
        <div tal:condition="python: field.getType().split('.')[-1] == 'ReferenceField'">
          <br/>
          <span class="label" i18n:translate="label">Relationship</span>
          <div>
            <input type="text" value="" size="40" 
                   name="fielddata.relationship:record:string"
                   tal:attributes="value python: field.relationship"/>
          </div>
        </div>

        <br/>
        <div>
          <div class="left">
            <span class="label" i18n:translate="visible_edit">Visible (Edit)</span >
            <div>
              <input type="checkbox" value="visible" 
                     name="fielddata.visible_edit:record:string"
                     tal:attributes="checked python: here.atse_isFieldVisible(field.getName(), 'edit', SCHEMA_ID)"/>
            </div>
         </div>

          <div class="left">
            <span class="label" i18n:translate="required">Visible (View)</span >
            <div>
              <input type="checkbox" value="visible" 
                     name="fielddata.visible_view:record:string"
                     tal:attributes="checked python: here.atse_isFieldVisible(field.getName(), 'view', SCHEMA_ID)"/>
            </div>
         </div>

          <div class="left">
            <span class="label" i18n:translate="required">Required</span >
            <div>
              <input type="checkbox" value="1" 
                     name="fielddata.required:record:int"
                     tal:attributes="checked field/required"/>
            </div>
         </div>
        
          <div class="left">
            <span class="label" i18n:translate="create_index">Create index</span>
            <div>
              <input type="checkbox" value="1" 
                     name="fielddata.createindex:record:int"
                     tal:attributes="checked field/createindex|nothing"/>
            </div>
          </div>
          <div class="clear"> </div>
        </div>

	<br/>
        <div> 
          <div class="field">
            <input type="submit" value="Save changes" class="standalone" i18n:attributes="value">
          </div> 
        </div>

      </form>
    </div>
  </div>
</metal:div>
