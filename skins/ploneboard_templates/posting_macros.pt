<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      i18n:domain="ploneboard">

<body>

    <div metal:define-macro="comment_body_start" tal:omit-tag="">

        <legend i18n:translate="legend_add_conversation">Details</legend>

        <input type="hidden" name="form.submitted" value="1" />

    </div>

    <div metal:define-macro="comment_body_title" tal:omit-tag="">

        <div class="field"
             tal:define="error_title errors/title|nothing;
                         Title request/title | nothing"
             tal:attributes="class python:test(error_title, 'field error', 'field')"> 

            <label for="title" i18n:translate="label_title_posting">Title</label>

            <span class="fieldRequired" title="Required">(Required)</span>

            <div i18n:translate="help_title_posting"
                 class="formHelp">
                Enter the title of the document.
            </div>
            
            <div tal:replace="error_title">Validation error output</div>

            <input type="text" 
                   name="title"
                   id="title"
                   value="#" 
                   size="40" 
                   tabindex=""
                   tal:attributes="value Title;
                                   tabindex tabindex/next;"
                   />

        </div>

    </div>

    <div metal:define-macro="comment_body_text" tal:omit-tag="">
      
        <div class="field"
             tal:define="error_text errors/text|nothing;
                         text python:request.get('text', '')"
             tal:attributes="class python:test(error_text, 'field error', 'field')"> 

            <label for="text" i18n:translate="label_body_text_posting">Body text</label> 

            <div i18n:translate="help_body_text_posting"
                 class="formHelp">
                The body text of the document. 
            </div>

            <div tal:replace="error_text">Validation Error Comment</div>

            <textarea name="text"
                      id="text"
                      tabindex=""
                      rows="15"
                      tal:attributes="tabindex tabindex/next;"
                      tal:content="text" 
                      />

        </div>

    </div>

    <div metal:define-macro="comment_body_buttons" tal:omit-tag="">

        <div class="row">
            <div class="label">&nbsp;</div>
            <div class="field"> 
                <input class="context" 
                       tabindex=""
                       type="submit" 
                       name="form.button.Preview" 
                       value="Preview" 
                       i18n:attributes="value preview_posting"
                       tal:attributes="tabindex tabindex/next;" 
                       /> 
                <input class="destructive"
                       tabindex=""
                       type="submit"
                       name="form.button.Cancel"
                       value="Cancel"
                       i18n:attributes="value cancel_posting"
                       tal:attributes="tabindex tabindex/next"
                       />
            </div>
        </div>
        
    </div>


    <!-- Preview macros -->
    <div metal:define-macro="comment_preview_hidden_vars" tal:omit-tag="">
        <input type="hidden"
               name="title"
               tal:condition="request/title | nothing"
               tal:attributes="value request/title" 
               />
        <input type="hidden"
               name="text"
               tal:attributes="value python:request.get('text', '')" 
               />
    </div>


    <div metal:define-macro="comment_preview" tal:omit-tag="">

        <h2 tal:condition="request/title | nothing"
            tal:content="request/title">
            Subject
        </h2>

        <div tal:define="nl2br python:modules['Products.PythonScripts.standard'].newline_to_br;
                         text python:request.get('text', '(no text)');
                         text python:here.portal_ploneboard.performCommentTransform(text, context=here);"
             tal:content="structure text">
            Cooked Body
        </div>

    </div>


    <div metal:define-macro="comment_preview_buttons" tal:omit-tag="">

        <div class="row">
            <div class="label">&nbsp;</div>
            <div class="field"> 
                <input class="standalone" 
                       tabindex=""
                       type="submit" 
                       name="form.button.Save" 
                       value="Post" 
                       i18n:attributes="value"
                       tal:attributes="tabindex tabindex/next;" /> 

                <input class="context" 
                       tabindex=""
                       type="submit" 
                       name="form.button.Edit" 
                       value="Change" 
                       i18n:attributes="value"
                       tal:attributes="tabindex tabindex/next;" /> 


                <input class="destructive"
                       tabindex=""
                       type="submit"
                       name="form.button.Cancel"
                       value="Cancel"
                       i18n:attributes="value"
                       tal:attributes="tabindex tabindex/next"
                       />
            </div>
        </div>
        
    </div>

</body>
</html>
